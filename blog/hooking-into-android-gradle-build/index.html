<!doctype html>
<html lang="en">
<head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Living at the intersection of Technology, Research, Economics & Art">
    <link rel="stylesheet" href="/css/pure-min.css">
    <link rel="stylesheet" href="/css/grids-responsive-min.css">
    <link rel="stylesheet" href="/css/blog.css">
    <link rel="stylesheet" href="/css/solarized_light.css">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54341244-1', 'auto');
  ga('send', 'pageview');

</script>

    <title>Hooking into Android Studio&#39;s Gradle build process</title>
</head>
<body>

<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <a href="/"><h1 class="brand-title">Curiosity &amp; the Geek</h1></a>
        <h2 class="brand-tagline">Life at the intersection of Technology, Insights & Art</h2>

        <nav class="nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a class="pure-button" href="/">All</a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" href="/blog">Blog</a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" href="/opensource">Opensource</a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" href="/about">About</a>
                </li>
                <li class="nav-item">
                <a class="pure-button" href="/index.xml"><img width="11" height="11" src="/img/common/rss.svg" />&nbsp;Subscribe</a>
                </li>
            </ul>
        </nav>
    </div>
</div>
    
    <div class="content pure-u-1 pure-u-md-3-4">
            
            <div class="posts">
                
                <section class="post">
                    <header class="post-header">
    <img class="post-avatar" alt="Hariharan Srinath" height="48" width="48" src="/img/profilepics/srinath.jpg">
    <a href="/blog/hooking-into-android-gradle-build/"><h2 class="post-title">Hooking into Android Studio&#39;s Gradle build process</h2></a>

    <p class="post-meta">
        By Hariharan Srinath 
        
            <a class="post-category" href="/tags/android-studio">android studio</a>
        
            <a class="post-category" href="/tags/gradle">gradle</a>
        
            <a class="post-category" href="/tags/hook">hook</a>
        
            <a class="post-category" href="/tags/assets">assets</a>
        
    </p>
</header>

                     <div class="socialbuttons" style="float:right">
    <a href="/index.xml"><img width="20" height="20" src="/img/common/rss.svg" /></a>
    <div class="g-plus" data-action="share" data-annotation="none"></div>
    <a href="https://twitter.com/share" class="twitter-share-button" data-via="srinathh" data-count="none" data-dnt="true">Tweet</a>
</div>



                    <div class="post-description">
                        

<h2 id="background">Background</h2>

<p>If you want to automate steps to re-build data-files or assets for an Android app every time
the app gets built in Android Studio, you need to hook into the Gradle based build process.
While Gradle itself has <a href="https://docs.gradle.org/current/userguide/userguide.html">impressive documentation</a>,
it was not very clear initially how to hook into an Android app&rsquo;s build process. This article shows how I
managed to make it work.</p>

<h2 id="issue">Issue</h2>

<p>I want to make an Android app which uses a <a href="https://developer.android.com/guide/webapps/webview.html">WebView</a>
to display a webapp built on <a href="https://facebook.github.io/react/">React Framework</a>. <a href="https://github.com/facebookincubator/create-react-app">Create React App</a>
is a simple way to bootstrap a react app using <a href="https://webpack.github.io/">WebPack</a> and
<a href="https://babeljs.io/">BabelJS</a> to translate JSX to plain JS and bundle the code. The
Create React App scripts provides a simple live-rebuild and webserver feature for local development
and makes an <code>npm run build</code> command available to generate an optimized build.</p>

<p>Rather than host this webapp on a server, I would like to make it available locally under the <code>assets</code>
folder in the Android app to minimize latency. I would also like the webapp automatically rebuilt
everytime I compile the android app and refreshed in the <code>assets</code> folder.</p>

<h2 id="solution">Solution</h2>

<p>The <a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Android-tasks">Android Gradle Plugin</a>
unfortunately uses fancy features of the Gradle DSL to build a task based on build target configurations
at runtime making it difficult to hook onto one of the <code>:assemble</code> or <code>:build</code> tasks while compiling.</p>

<p>However, one of the early tasks that runs during Android App compilation with Gradle is
called <code>:preBuild</code> and allows us to reliably hook into it for running or own asset generation
routines.</p>

<p>To do this, I appended the following at the bottom of <code>build.gradle</code> of the android application.
I first create a Gradle <a href="https://docs.gradle.org/current/dsl/org.gradle.api.tasks.Exec.html">Exec</a>
task which runs the <code>npm run build</code> command in the directory containing the webapp sources. I then
create a Gradle <a href="https://docs.gradle.org/current/dsl/org.gradle.api.tasks.Sync.html">Sync</a> that copies
the generated webapp files to the <code>assets</code> folder. The <code>Sync</code> task depends on the <code>Exec</code> task. Finally
I make the Android build&rsquo;s <code>:preBuild</code> task depend on our <code>Sync</code> task so that the assets are build
and copied before the Android app is compiled.</p>

<pre><code>task buildWebApp(type:Exec) {
    workingDir '../../webapp'
    //on linux
    commandLine 'npm', 'run', 'build'
}

task syncWebApp(type: Sync, dependsOn:'buildWebApp') {
    from '../../webapp/build'
    into 'src/main/assets/build'
    println 'in syncWebApp'
}

preBuild.dependsOn(syncWebApp)
</code></pre>

                    </div>
                </section>
            </div>
            
                <div id="disqus_thread"></div>
    <script type="text/javascript">
         
        var disqus_shortname = 'srinathhgithubio'; 

         
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li><a href="#">&copy; 2014, Hariharan Srinath</a></li>
            <li><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons Attribution-ShareAlike 4.0 International License" style="border-width:0" src="/img/ccbysa.png" /></a></li>
            <li><a href="http://purecss.io">Pure CSS</a></li>
            <li><a href="http://hugo.spf13.com">Hugo</a></li>
        </ul>
    </div>
</div>
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    </div>
</div>
<script src="https://apis.google.com/js/platform.js" async defer></script>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


</body>
</html>
